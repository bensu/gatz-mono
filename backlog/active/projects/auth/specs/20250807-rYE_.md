---
id: 20250807-rYE_
project: auth
title: 'Authentication Migration: Twilio SMS to Apple/Google Sign-In'
created: '2025-08-07'
updated: '2025-08-07'
status: todo
author: developer
archived: false
---

Migrate from Twilio SMS-only authentication to Apple/Google Sign-In through a three-phase approach:

## Problem Statement
- Currently using Twilio SMS as the sole authentication method
- Need to migrate away from Twilio towards Apple and Google Sign-In
- Must preserve existing user data and provide smooth migration experience
- New users should only be able to sign up with Apple/Google after migration begins

## Three-Phase Approach

### Phase 1: Implement New Sign-In Methods
- Add Apple Sign-In alongside existing Twilio SMS
- Add Google Sign-In alongside existing Twilio SMS
- Both new and existing users can use any of the three methods
- Extend user schema to store social auth identifiers alongside phone numbers

### Phase 2: Restrict Twilio to Existing Users
- New users can only sign up with Apple/Google
- Existing users can still sign in with Twilio SMS
- Disable SMS signup flow for new accounts

### Phase 3: Forced Migration
- Create migration screen that appears for SMS-only users on app open
- Force existing Twilio users to add Apple/Google account when they open app
- Link social account to existing phone-based account while user is logged in
- Once migrated, user can sign in with either method
- Provide email-based authentication for users without Apple/Google accounts

## Technical Implementation

### Database Schema Changes
```sql
ALTER TABLE users ADD COLUMN apple_id TEXT;
ALTER TABLE users ADD COLUMN google_id TEXT;
ALTER TABLE users ADD COLUMN email TEXT;
ALTER TABLE users ADD COLUMN auth_method TEXT DEFAULT 'sms';
ALTER TABLE users ADD COLUMN migration_completed_at TIMESTAMP;
```

### API Changes
- Modify GET /me to include migration status (instead of new endpoint)
- Add POST /auth/apple, /auth/google for new users
- Add POST /auth/link-apple, /auth/link-google for existing users
- Add POST /auth/link-email for alternative auth

### Migration Flow
1. SMS-only users see migration screen on app open (from /me response)
2. Dismissible banner explaining need to add Apple/Google account
3. Complete OAuth while logged in, link to existing account
4. User can then sign in with either method

### Account Linking Strategy
- New users: Create fresh accounts with Apple/Google (no linking)
- Existing users: Link Apple/Google to logged-in SMS account
- No email-based linking (users don't have emails currently)
- Immediate forced migration (users must migrate on next app open)

### Fallback Handling
- Contact support option if Apple/Google fails
- Email-based authentication for users without Apple/Google accounts
- Preserve all user data during migration

## Timeline
- Phase 1: Weeks 1-4 (implement new auth methods)
- Wait 2 months for monitoring and fixes
- Phase 2: Week 17 (restrict SMS to existing users)
- Wait 1 month for stabilization
- Phase 3: Week 21 (begin forced migration)