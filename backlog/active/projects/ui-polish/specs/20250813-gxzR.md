---
id: 20250813-gxzR
project: ui-polish
title: Signal-Style Swipe-to-Reply Animation Enhancement
created: '2025-08-13'
updated: '2025-08-13'
status: done
author: developer
archived: false
---

# Gatz Swipe-to-Reply Enhancement Specification

## Overview

Enhance Gatz's existing swipe-to-reply animation to match Signal iOS's polished feel while maintaining integration with Gatz's existing React Native + Reanimated architecture.

## User Stories

**As a Gatz user**, I want the swipe-to-reply gesture to feel as smooth and polished as Signal's implementation, so that my messaging interactions feel premium and responsive.

**As a developer**, I want to enhance the existing animation without breaking current functionality, so that we maintain backward compatibility while improving user experience.

## Design Decisions

- **Timing**: Signal's exact 200ms duration with 0.06 damping for bouncy feel
- **Threshold**: Scale to 15% screen width (existing Gatz approach) 
- **Icon**: Adapt to Gatz's existing icon scale with MaterialIcons
- **Parallax**: Full Signal parallax effect (message 100%, background 25%)
- **Resistance**: Signal's 20% resistance factor beyond threshold
- **Integration**: Enhance current `AnimatedMessageInnerRowInChat` implementation

## Technical Requirements

### Animation Constants
```typescript
const SWIPE_ANIMATION_CONFIG = {
  duration: 200,
  damping: 0.06,
  initialSpringVelocity: 0.8,
  stiffness: 400
};

const ACTIVATION_THRESHOLD = SCREEN_WIDTH * 0.15; // ~55-65pt on most devices
const ELASTIC_RESISTANCE_FACTOR = 0.2;
const PARALLAX_BACKGROUND_RATIO = 0.25;
const ICON_SCALE_ACTIVE = 1.16;
```

### Enhanced Gesture Logic
```typescript
// Current translation with parallax and elastic resistance
const fastOffset = Math.min(translationX, ACTIVATION_THRESHOLD);
const slowOffset = fastOffset * PARALLAX_BACKGROUND_RATIO;

// Elastic resistance beyond threshold
if (translationX > ACTIVATION_THRESHOLD) {
  const overshoot = translationX - ACTIVATION_THRESHOLD;
  const resistance = overshoot * ELASTIC_RESISTANCE_FACTOR;
  finalOffset = ACTIVATION_THRESHOLD + resistance;
}
```

### Reply Icon Enhancement
- Position: 8pt offset from message left edge, vertically centered
- Scale animation: 1.0 → 1.16 when threshold crossed
- Color transition: colors.strongGrey → colors.textPrimary when active
- Alpha: Progressive fade-in based on swipe progress (0 → 1)

## Implementation Details

### Primary File
**File**: `app/src/gifted/Message/index.tsx`
- **Target**: `AnimatedMessageInnerRowInChat` component (lines 1118-1291)
- **Current State**: Basic swipe gesture with simple spring animation

### Specific Changes Required

1. **Replace Spring Configuration**
   - Current: Simple `pullSpring` function with basic timing
   - New: Signal's bouncy spring with 0.06 damping and 0.8 initial velocity

2. **Add Parallax Effect**
   - Message container: Full speed translation
   - Background elements: 25% speed translation for depth

3. **Implement Elastic Resistance**
   - Beyond threshold: Apply 20% resistance factor
   - Prevents jarring stops, provides smooth feel

4. **Enhance Icon Animation**
   - Scale: 1.0 → 1.16 when threshold crossed
   - Color: Smooth transition based on activation state
   - Alpha: Progressive fade based on swipe progress

5. **Improve Animation Cleanup**
   - Use `cancelAnimation()` before new animations
   - Maintain existing `isMountedObj` cleanup pattern

### Integration Points

**Existing Gesture Handler** (lines 1189-1228):
```typescript
const panGesture = Gesture.Pan()
  .onUpdate((e) => {
    // Enhanced with parallax and elastic resistance
  })
  .onEnd(() => {
    // Enhanced with Signal's spring animation
  });
```

**Current Icon Animation** (lines 1151-1160):
```typescript
const replyIconContainerStyle = useAnimatedStyle(() => {
  // Enhance with scale and color transitions
});
```

## Performance Considerations
- Use `cancelAnimation()` before applying new animations
- Apply transforms to wrapper views for smooth performance
- Use `runOnJS()` for gesture completion callbacks
- Maintain existing cleanup patterns for React 19 compatibility

## Accessibility Requirements
- Preserve existing VoiceOver navigation compatibility
- Maintain alternative reply methods through long-press menu
- Ensure gesture doesn't interfere with scroll accessibility
- Test with assistive technologies

## Quality Assurance

### Testing Requirements
1. **Unit Tests**: Update existing gesture tests for new animation parameters
2. **Integration Tests**: Verify compatibility with long-press menu and hover states
3. **Performance Tests**: Ensure smooth 60fps animations on low-end devices
4. **Accessibility Tests**: VoiceOver and TalkBack compatibility

### Success Criteria
- [ ] Swipe-to-reply feels as smooth as Signal iOS
- [ ] No regression in existing functionality
- [ ] Maintains 60fps performance on target devices
- [ ] Passes accessibility audit
- [ ] Works seamlessly with existing gesture combinations

## Dependencies
- Existing: `react-native-reanimated` (already integrated)
- Existing: `react-native-gesture-handler` (already integrated)
- Existing: Gatz theme system for colors

## Risks and Mitigations
- **Risk**: New spring parameters may feel too bouncy for some users
- **Mitigation**: A/B test with existing animation, provide preference toggle if needed

- **Risk**: Parallax effect may cause motion sickness
- **Mitigation**: Respect system motion settings, provide disable option

- **Risk**: Performance regression on older devices
- **Mitigation**: Performance testing on minimum supported devices

## Future Enhancements
- Haptic feedback on threshold crossing
- Customizable spring parameters per user preference
- Advanced parallax effects for media messages