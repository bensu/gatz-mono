---
id: 20250808-0000.2Zc_
title: Add Account Linking Settings UI
created: '2025-08-08'
updated: '2025-08-09'
spec: null
project: null
status: done
archived: false
---

Create account linking management UI in the settings screen that displays the user's email and linked social accounts (Apple, Google), with a button to trigger the existing migration modal for linking additional authentication methods.

## Requirements

### 1. Settings Integration - Add to existing "Log in" section
- Add account linking display below the phone number in the existing "Log in" section  
- Show user's email address if available
- Display simple text list of linked accounts ("Linked: Apple, Google, Email" or "Linked: SMS only")

### 2. Current Account Status Display
- Show which authentication methods are already linked to the account
- Always show "Link additional accounts" button with generic text regardless of current linking status
- Modal will automatically disable already linked options when opened

### 3. User Interaction Flow  
- Button labeled "Link additional accounts" triggers existing MigrationScreen component
- Pass user's current linking status to modal for filtering available options
- Modal shows success notification on successful linking, then refreshes settings to show updated status

### 4. UI Implementation Details
- Use existing settings UI patterns and styling from settings.tsx
- Follow current row layout structure with proper theme colors and typography
- Maintain visual consistency with other settings sections (Profile, Notifications, etc.)

### 5. Technical Integration
- Reuse existing MigrationScreen component without modifications
- Backend linking endpoints already implemented (`link-apple!`, `link-google!`, `link-email!`) 
- Update settings screen to display refreshed user data after successful linking
- Handle all existing error cases and success states from MigrationScreen

### 6. Data Flow
- Read current user authentication status from user object (email, apple_id, google_id fields)
- Pass GatzClient instance to MigrationScreen for email linking functionality  
- Refresh user data subscription after successful linking to show updated account status
- Display updated linked accounts list immediately after modal closes

### 7. Edge Cases & Error Handling
- Handle users with no linked accounts (SMS-only users) - show "Linked: SMS only"
- Handle users with all methods already linked - still show button but modal disables all options
- Proper error handling if linking process fails (handled by MigrationScreen)
- Handle deleted/invalid user accounts gracefully

## Implementation Approach

### Frontend Changes (settings.tsx)
1. **Add account status display**:
   - Below phone number row in "Log in" section
   - Show email address if user.email exists
   - Show linked authentication methods in simple text format

2. **Add linking button**:
   - "Link additional accounts" button using existing button styling
   - Opens MigrationScreen modal with current user context

3. **Modal integration**:
   - Import and use existing MigrationScreen component
   - Pass current user data and GatzClient instance
   - Handle success callback to refresh settings data

### No Backend Changes Needed
- Manual linking endpoints already implemented (`/api/user/link-apple`, `/api/user/link-google`, `/api/user/link-email`)
- User data already includes auth fields (apple_id, google_id, email)
- MigrationScreen handles all linking logic and API calls

## Success Criteria
- Settings screen shows current email and linked authentication methods
- "Link additional accounts" button opens migration modal
- Users can successfully link Apple ID, Google ID, or email from settings
- Settings display updates immediately after successful linking
- All existing error handling and validation continues to work
- UI maintains consistency with existing settings design patterns

## Technical Notes  
- File to modify: `app/src/app/(app)/(drawer)/settings.tsx`
- Reuse: `app/src/components/MigrationScreen.tsx` (no changes needed)
- Backend endpoints: Already implemented in `server/src/gatz/api/user.clj`
- User data structure: Uses existing user.email, user.apple_id, user.google_id fields