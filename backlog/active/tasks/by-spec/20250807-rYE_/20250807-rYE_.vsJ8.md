---
id: 20250807-rYE_.vsJ8
title: Add feature flag to disable SMS signup for new users
created: '2025-08-07'
updated: '2025-08-07'
spec: 20250807-rYE_
project: auth
status: todo
archived: false
---

Use existing feature flag system to disable SMS signup for new users while allowing existing users to continue using SMS.

## Requirements
- Use existing feature flag system in codebase
- Add SMS_SIGNUP_DISABLED flag
- Disable SMS signup flow for new users only
- Existing users can still sign in with SMS
- Feature flag should be toggleable for rollback

## Implementation Details
- Identify existing feature flag system implementation
- Add new flag: SMS_SIGNUP_DISABLED (default: false)
- Modify signup endpoints to check flag
- Update frontend signup flow to hide SMS option when flag is enabled
- Maintain existing user SMS sign-in functionality

## Backend Changes
- Check SMS_SIGNUP_DISABLED flag in verify-phone endpoint
- Return error for new users when signup is disabled
- Allow existing users to continue SMS verification
- Log signup attempts when disabled

## Frontend Changes
- Hide SMS signup UI when flag is enabled
- Show only Apple/Google signup options for new users
- Maintain SMS signin option for existing users
- Handle signup disabled error gracefully

## Flag Logic
```clojure
(defn sms-signup-allowed? [ctx phone]
  (or 
    (not (flags/enabled? ctx :SMS_SIGNUP_DISABLED))
    (some? (db.user/by-phone (:biff/db ctx) phone))))
```

## Rollback Strategy
- Feature flag can be disabled to re-enable SMS signup
- No database changes needed for rollback
- Immediate effect when flag is toggled

## Acceptance Criteria
- [ ] SMS_SIGNUP_DISABLED feature flag added
- [ ] New users cannot sign up via SMS when flag enabled
- [ ] Existing users can still sign in via SMS
- [ ] Frontend hides SMS signup option when flag enabled
- [ ] Feature flag can be toggled for immediate rollback
- [ ] Proper error handling when SMS signup disabled
- [ ] Logging of signup attempts when disabled