---
id: 20250807-rYE_.uM8Y
title: Extend user database schema for social auth
created: '2025-08-07'
updated: '2025-08-07'
spec: 20250807-rYE_
project: auth
status: in_progress
archived: false
---

Extend the user database schema to support Apple/Google authentication using XTDB transaction functions.

## Requirements
- Add `apple_id` TEXT field to store Apple Sign-In identifier
- Add `google_id` TEXT field to store Google Sign-In identifier  
- Add `email` TEXT field for email-based fallback authentication
- Add `auth_method` TEXT field with default 'sms' (values: 'sms', 'apple', 'google', 'email', 'hybrid')
- Add `migration_completed_at` timestamp field

## Implementation Details
- Use XTDB-style transaction functions for schema changes
- Ensure backward compatibility with existing user records
- Create rollback capability for schema changes
- Update user creation and validation functions

## Acceptance Criteria
- [ ] New fields added to user schema
- [ ] Existing users maintain all current data
- [ ] New users can be created with social auth fields
- [ ] Database migration can be rolled back if needed
- [ ] User lookup functions work with new fields