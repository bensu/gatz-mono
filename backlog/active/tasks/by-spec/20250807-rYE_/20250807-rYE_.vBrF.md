---
id: 20250807-rYE_.vBrF
title: Update /me endpoint for migration status
created: '2025-08-07'
updated: '2025-08-07'
spec: 20250807-rYE_
project: auth
status: done
archived: false
---

Update the existing GET /me endpoint to include migration status information for triggering migration screens.

## Requirements
- Add migration status to existing /me endpoint response
- Determine if user needs to migrate (auth_method = 'sms')
- Include information for frontend to show appropriate UI
- Maintain existing /me response structure
- No breaking changes to current /me functionality

## Implementation Details
- Extend existing get-me-data function
- Add migration object to response when user needs migration
- Check user's auth_method and migration_completed_at fields
- Return migration status based on user's current auth state

## Response Structure
Add to existing /me response:
```json
{
  "user": { ... existing user data ... },
  "groups": [ ... ],
  "contacts": [ ... ],
  "contact_requests": [ ... ],
  "flags": { ... },
  "migration": {
    "required": true,
    "auth_method": "sms", 
    "show_migration_screen": true,
    "completed_at": null
  }
}
```

## Migration Logic
- `required`: true if auth_method is 'sms' and migration_completed_at is null
- `show_migration_screen`: true for first-time migration prompt
- `auth_method`: current user's authentication method
- `completed_at`: timestamp when migration was completed (null if not completed)

## Acceptance Criteria
- [ ] /me endpoint includes migration object
- [ ] Migration status correctly identifies SMS-only users
- [ ] No breaking changes to existing /me response
- [ ] Migration object only included when relevant
- [ ] Frontend can determine when to show migration UI
- [ ] Completed migrations properly reflected in response