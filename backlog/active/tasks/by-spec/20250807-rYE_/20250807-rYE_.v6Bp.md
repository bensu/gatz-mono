---
id: 20250807-rYE_.v6Bp
title: Update authentication flows and add comprehensive error handling
created: '2025-08-07'
updated: '2025-08-07'
spec: 20250807-rYE_
project: auth
status: in_progress
archived: false
---

Update authentication flows to support multiple auth methods and add comprehensive error handling with specific user messages.

## Requirements
- Update sign-in flow routing to handle Apple/Google/SMS/email
- Add comprehensive error handling for all auth methods
- Display specific error messages to users (network, cancelled, etc.)
- Update authentication state management
- Handle auth method switching and hybrid accounts

## Frontend Auth Flow Updates
- Modify sign-in screen to support multiple auth methods
- Update authentication service to handle different token types
- Add auth method detection and routing
- Support for hybrid users (multiple auth methods)
- Proper session management for all auth types

## Error Handling Implementation
- Network connectivity errors
- OAuth cancellation by user  
- Invalid/expired tokens
- Account not found errors
- Account linking conflicts
- Service unavailable errors
- Rate limiting errors

## Error Messages
```typescript
const AUTH_ERRORS = {
  NETWORK_ERROR: "Please check your internet connection and try again",
  CANCELLED: "Sign-in was cancelled. Please try again when you're ready",
  INVALID_TOKEN: "Authentication failed. Please try signing in again", 
  ACCOUNT_NOT_FOUND: "No account found. Please sign up first",
  ACCOUNT_CONFLICT: "This account is already linked to another user",
  SERVICE_UNAVAILABLE: "Authentication service is temporarily unavailable",
  RATE_LIMITED: "Too many attempts. Please wait before trying again",
  UNKNOWN_ERROR: "Something went wrong. Please contact support if this continues"
};
```

## State Management Updates
- Support multiple auth methods in user state
- Track current auth method for the session
- Handle auth method transitions
- Update token refresh logic for different auth types

## Authentication Service Refactoring
- Create unified authentication interface
- Abstract auth method specifics
- Common error handling patterns
- Consistent token management
- Session persistence improvements

## Acceptance Criteria
- [ ] Sign-in flow supports Apple/Google/SMS/email methods
- [ ] Specific error messages shown for different failure types
- [ ] Network errors handled gracefully with retry options
- [ ] OAuth cancellation handled without app crashes
- [ ] Invalid token errors trigger re-authentication flow
- [ ] Rate limiting errors show appropriate wait messages
- [ ] Hybrid users can switch between auth methods
- [ ] Authentication state properly managed across app
- [ ] Error logging for debugging and monitoring
- [ ] Consistent UX across all auth methods