---
id: 20250813-gxzR.mOpd
title: Implement Signal-style animation constants and gesture logic
created: '2025-08-13'
updated: '2025-08-13'
spec: 20250813-gxzR
project: ui-polish
status: done
archived: false
---

# Task: Implement Signal-style animation constants and gesture logic

**Spec Reference**: 20250813-gxzR - Signal-Style Swipe-to-Reply Animation Enhancement

## Objective
Replace Gatz's current basic swipe animation with Signal iOS's sophisticated gesture logic including elastic resistance, parallax effects, and bouncy spring parameters.

## Implementation Details

### File to Modify
`app/src/gifted/Message/index.tsx` - `AnimatedMessageInnerRowInChat` component (lines 1118-1291)

### Changes Required

1. **Replace Animation Constants**
   - Current: `TRANSLATE_X_THRESHOLD = SCREEN_WIDTH * 0.15` (keep this)
   - Add: Signal's spring configuration
   ```typescript
   const SWIPE_ANIMATION_CONFIG = {
     duration: 200,
     damping: 0.06,
     initialSpringVelocity: 0.8,
     stiffness: 400
   };
   
   const ELASTIC_RESISTANCE_FACTOR = 0.2;
   const PARALLAX_BACKGROUND_RATIO = 0.25;
   ```

2. **Replace pullSpring Function** (line 924-927)
   - Current: Simple `return x / 2;`
   - New: Elastic resistance logic
   ```typescript
   const pullSpring = (x: number, threshold: number): number => {
     "worklet";
     if (x <= threshold) {
       return x;
     }
     const overshoot = x - threshold;
     const resistance = overshoot * ELASTIC_RESISTANCE_FACTOR;
     return threshold + resistance;
   };
   ```

3. **Update Pan Gesture Handler** (lines 1205-1224)
   - Add parallax effect for message and background elements
   - Use new spring configuration in onEnd
   ```typescript
   .onUpdate((e) => {
     "worklet";
     if (e.translationX > 0) {
       translateX.value = pullSpring(e.translationX, TRANSLATE_X_THRESHOLD);
       // Add parallax logic here
     }
   })
   .onEnd(() => {
     "worklet";
     const shouldReply = translateX.value > TRANSLATE_X_THRESHOLD;
     translateX.value = withSpring(0, SWIPE_ANIMATION_CONFIG);
     // Rest remains the same
   })
   ```

4. **Add Parallax Effect**
   - Message container: Full speed translation
   - Background/avatar elements: 25% speed translation
   - Modify animated styles to support dual-speed movement

5. **Animation Cleanup**
   - Use existing `isMountedObj` pattern
   - Keep existing `cancelAnimation()` usage

## Testing Requirements
- Update existing gesture tests for new animation parameters
- Verify no regression in current swipe-to-reply functionality
- Test threshold behavior with elastic resistance

## Success Criteria
- [ ] Swipe gesture has Signal's bouncy spring feel (0.06 damping)
- [ ] Elastic resistance prevents jarring stops beyond threshold
- [ ] Parallax effect provides depth perception
- [ ] No regression in existing functionality
- [ ] Maintains existing cleanup patterns